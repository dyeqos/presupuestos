"use strict";(self.webpackChunkpresupuestoFrontend=self.webpackChunkpresupuestoFrontend||[]).push([[294],{7294:(tt,b,n)=>{n.r(b),n.d(b,{UsuariosModule:()=>W});var p=n(9808),e=n(3075),v=n(1083),t=n(5e3),f=n(520),q=n(2340),N=n(6518);let U=(()=>{class r{constructor(o,a){this.http=o,this.authService=a,this.baseUrl=q.N.baseUrl}getUsuarios(o=""){return this.http.get(`${this.baseUrl}/usuarios/${o}`)}getPerfil(){const o=`${this.baseUrl}/usuarios/perfil`,a=(new f.WM).set("x-token",this.authService.token);return this.http.get(o,{headers:a})}postUsuario(o){const a=`${this.baseUrl}/usuarios/`,s=(new f.WM).set("x-token",this.authService.token);return this.http.post(a,o,{headers:s})}putUsuario(o){const a=`${this.baseUrl}/usuarios/`,s=(new f.WM).set("x-token",this.authService.token);return this.http.put(a,o,{headers:s})}deleteUsuario(o){const a=`${this.baseUrl}/usuarios/`,s={headers:(new f.WM).set("x-token",this.authService.token).set("content-type","application/json"),body:{uid:o}};return this.http.delete(a,s)}}return r.\u0275fac=function(o){return new(o||r)(t.LFG(f.eN),t.LFG(N.e))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var C=n(5626);let S=(()=>{class r{constructor(){this.soloLetras="([a-zA-Z]+) ([a-zA-Z]+)",this.soloEmail="^[a-z0-9.%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"}contrasenaIgual(o,a){return s=>{var u,d,_,Z;return(null===(u=s.get(o))||void 0===u?void 0:u.value)!==(null===(d=s.get(a))||void 0===d?void 0:d.value)?(null===(_=s.get(a))||void 0===_||_.setErrors({noIguales:!0}),{noIguales:!0}):(null===(Z=s.get(a))||void 0===Z||Z.setErrors(null),null)}}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var g=n(7423),l=n(9224),h=n(2349),c=n(7322),T=n(5245),A=n(7531),x=n(4107),k=n(508);function y(r,i){if(1&r&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&r){const o=i.$implicit;t.Q6J("value",o.uid),t.xp6(1),t.hij(" ",o.nombre," ")}}function R(r,i){if(1&r){const o=t.EpF();t.TgZ(0,"mat-card")(1,"form",1),t.NdJ("ngSubmit",function(){t.CHM(o);const s=t.oxw();return t.KtG(s.guardarUsuario())}),t.TgZ(2,"mat-card-header")(3,"mat-card-title"),t._uU(4,"Mi Perfil"),t.qZA(),t.TgZ(5,"mat-card-subtitle"),t._uU(6,"Modificar"),t.qZA()(),t.TgZ(7,"mat-card-content")(8,"mat-form-field",2)(9,"mat-label"),t._uU(10,"Nombre"),t.qZA(),t._UZ(11,"input",3),t.TgZ(12,"mat-error"),t._uU(13," Revise el Nombre "),t.qZA()(),t.TgZ(14,"mat-form-field",2)(15,"mat-label"),t._uU(16,"Apellido Paterno"),t.qZA(),t._UZ(17,"input",4),t.TgZ(18,"mat-error"),t._uU(19," Revise el Apellido "),t.qZA()(),t.TgZ(20,"mat-form-field",2)(21,"mat-label"),t._uU(22,"Apellido Materno"),t.qZA(),t._UZ(23,"input",5),t.TgZ(24,"mat-error"),t._uU(25," Revise el Apellido "),t.qZA()(),t.TgZ(26,"mat-form-field",2)(27,"mat-label"),t._uU(28,"Correo"),t.qZA(),t._UZ(29,"input",6),t.TgZ(30,"mat-error"),t._uU(31," Revise el Correo "),t.qZA()(),t.TgZ(32,"mat-form-field",2)(33,"mat-label"),t._uU(34,"Rol de Usuario"),t.qZA(),t.TgZ(35,"mat-select",7),t.YNc(36,y,2,2,"mat-option",8),t.qZA(),t.TgZ(37,"mat-error"),t._uU(38," Revise el Rol de Usuario "),t.qZA()(),t.TgZ(39,"mat-form-field",2)(40,"mat-label"),t._uU(41,"Nuevo Password"),t.qZA(),t._UZ(42,"input",9),t.TgZ(43,"button",10),t.NdJ("click",function(){t.CHM(o);const s=t.oxw();return t.KtG(s.hide=!s.hide)}),t.TgZ(44,"mat-icon"),t._uU(45),t.qZA()(),t.TgZ(46,"mat-error"),t._uU(47," Contrase\xf1a m\xednima de 6 car\xe1cteres "),t.qZA()(),t.TgZ(48,"mat-form-field",2)(49,"mat-label"),t._uU(50,"Repetir Password"),t.qZA(),t._UZ(51,"input",11),t.TgZ(52,"button",10),t.NdJ("click",function(){t.CHM(o);const s=t.oxw();return t.KtG(s.hide2=!s.hide2)}),t.TgZ(53,"mat-icon"),t._uU(54),t.qZA()(),t.TgZ(55,"mat-error"),t._uU(56," No son iguales las contrase\xf1as "),t.qZA()()(),t.TgZ(57,"mat-card-actions")(58,"button",12),t._uU(59,"Cancelar"),t.qZA(),t.TgZ(60,"button",13),t._uU(61,"Guardar"),t.qZA()()()()}if(2&r){const o=t.oxw();t.xp6(1),t.Q6J("formGroup",o.formUsuario),t.xp6(35),t.Q6J("ngForOf",o.roles),t.xp6(6),t.Q6J("type",o.hide?"password":"text"),t.xp6(3),t.hij(" ",o.hide?"visibility_off":"visibility"," "),t.xp6(6),t.Q6J("type",o.hide2?"password":"text"),t.xp6(3),t.hij(" ",o.hide2?"visibility_off":"visibility"," ")}}let w=(()=>{class r{constructor(o,a,s,u){this.fb=o,this.usuarioService=a,this.parametrosService=s,this.vs=u,this.hide=!0,this.hide2=!0,this.formUsuario=this.fb.group({nombre:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],paterno:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],materno:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],correo:["",[e.kI.required,e.kI.email]],rol:["",[e.kI.required]],password:["",[e.kI.required,e.kI.minLength(6)]],password2:["",[e.kI.required]]},{validators:[this.vs.contrasenaIgual("password","password2")]})}ngOnInit(){this.cargarRol(),this.cargarUsuario()}cargarRol(){this.parametrosService.getRoles().subscribe(o=>{!0===o.ok&&(this.roles=o.data)})}cargarUsuario(){this.usuarioService.getPerfil().subscribe(o=>{!0===o.ok&&(this.usuario=o.data,this.formUsuario.controls.nombre.setValue(this.usuario.nombre),this.formUsuario.controls.paterno.setValue(this.usuario.paterno),this.formUsuario.controls.materno.setValue(this.usuario.materno),this.formUsuario.controls.correo.setValue(this.usuario.correo),this.formUsuario.controls.rol.setValue(this.usuario.rol._id))})}guardarUsuario(){this.formUsuario.invalid?this.formUsuario.markAllAsTouched():(this.usuario.nombre=this.formUsuario.controls.nombre.value.trim().toUpperCase(),this.usuario.paterno=this.formUsuario.controls.paterno.value.trim().toUpperCase(),this.usuario.materno=this.formUsuario.controls.materno.value.trim().toUpperCase(),this.usuario.correo=this.formUsuario.controls.correo.value.trim().toLowerCase(),this.usuario.rol=this.formUsuario.controls.rol.value,this.usuario.password=this.formUsuario.controls.password.value,console.log("paso"),this.usuarioService.putUsuario(this.usuario).subscribe(o=>{}))}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(e.qu),t.Y36(U),t.Y36(C.u),t.Y36(S))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-perfil"]],decls:1,vars:1,consts:[[4,"ngIf"],["autocomplete","off",3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","nombre"],["matInput","","formControlName","paterno"],["matInput","","formControlName","materno"],["matInput","","formControlName","correo"],["formControlName","rol"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","password","required","",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","password2","required","",3,"type"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary","type","submit"],[3,"value"]],template:function(o,a){1&o&&t.YNc(0,R,62,6,"mat-card",0),2&o&&t.Q6J("ngIf",a.usuario&&a.roles)},dependencies:[p.sg,p.O5,e._Y,e.Fj,e.JJ,e.JL,e.Q7,e.sg,e.u,g.lW,l.a8,l.dk,l.dn,l.n5,l.$j,l.hq,h.ZT,c.TO,c.KE,c.hX,c.R9,T.Hw,A.Nt,x.gD,k.ey],styles:["mat-form-field[_ngcontent-%COMP%]{display:block;margin-top:10px}mat-card[_ngcontent-%COMP%]{max-width:500px;margin:auto}"]}),r})();function M(r,i){if(1&r&&(t.TgZ(0,"mat-option",10),t._uU(1),t.qZA()),2&r){const o=i.$implicit;t.Q6J("value",o.uid),t.xp6(1),t.hij(" ",o.nombre," ")}}let I=(()=>{class r{constructor(o,a,s,u){this.data=o,this.dialogRef=a,this.fb=s,this.usuarioService=u,this.roles=this.data.roles,this.usuario=this.data.usuario||{},this.formUsuario=this.fb.group({nombre:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],paterno:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],materno:["",[e.kI.required,e.kI.minLength(3),e.kI.maxLength(30)]],correo:["",[e.kI.required,e.kI.email]],rol:["",[e.kI.required]],password:["123456",[e.kI.required,e.kI.minLength(6)]]})}ngOnInit(){this.cargarFormulario()}cargarFormulario(){this.usuario.uid&&(this.formUsuario.controls.nombre.setValue(this.usuario.nombre),this.formUsuario.controls.paterno.setValue(this.usuario.paterno),this.formUsuario.controls.materno.setValue(this.usuario.materno),this.formUsuario.controls.correo.setValue(this.usuario.correo),this.formUsuario.controls.rol.setValue(this.usuario.rol._id))}guardarUsuario(){this.formUsuario.invalid?this.formUsuario.markAllAsTouched():(this.usuario.nombre=this.formUsuario.controls.nombre.value.trim().toUpperCase(),this.usuario.paterno=this.formUsuario.controls.paterno.value.trim().toUpperCase(),this.usuario.materno=this.formUsuario.controls.materno.value.trim().toUpperCase(),this.usuario.correo=this.formUsuario.controls.correo.value.trim().toLowerCase(),this.usuario.rol=this.formUsuario.controls.rol.value,this.usuario.password=this.formUsuario.controls.password.value,void 0!==this.usuario.uid?this.usuarioService.putUsuario(this.usuario).subscribe(o=>{this.dialogRef.close(!0===o.ok)}):this.usuarioService.postUsuario(this.usuario).subscribe(o=>{this.dialogRef.close(!0===o.ok)}))}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(h.WI),t.Y36(h.so),t.Y36(e.qu),t.Y36(U))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-usuarios-modal"]],decls:44,vars:2,consts:[["autocomplete","off",3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","nombre"],["matInput","","formControlName","paterno"],["matInput","","formControlName","materno"],["matInput","","formControlName","correo"],["formControlName","rol"],[3,"value",4,"ngFor","ngForOf"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary","type","submit"],[3,"value"]],template:function(o,a){1&o&&(t.TgZ(0,"mat-card")(1,"form",0),t.NdJ("ngSubmit",function(){return a.guardarUsuario()}),t.TgZ(2,"mat-card-header")(3,"mat-card-title"),t._uU(4,"Usuario"),t.qZA(),t.TgZ(5,"mat-card-subtitle"),t._uU(6,"Nuevo"),t.qZA()(),t.TgZ(7,"mat-card-content")(8,"mat-form-field",1)(9,"mat-label"),t._uU(10,"Nombre"),t.qZA(),t._UZ(11,"input",2),t.TgZ(12,"mat-error"),t._uU(13," Revise el Nombre "),t.qZA()(),t.TgZ(14,"mat-form-field",1)(15,"mat-label"),t._uU(16,"Apellido Paterno"),t.qZA(),t._UZ(17,"input",3),t.TgZ(18,"mat-error"),t._uU(19," Revise el Apellido "),t.qZA()(),t.TgZ(20,"mat-form-field",1)(21,"mat-label"),t._uU(22,"Apellido Materno"),t.qZA(),t._UZ(23,"input",4),t.TgZ(24,"mat-error"),t._uU(25," Revise el Apellido "),t.qZA()(),t.TgZ(26,"mat-form-field",1)(27,"mat-label"),t._uU(28,"Correo"),t.qZA(),t._UZ(29,"input",5),t.TgZ(30,"mat-error"),t._uU(31," Revise el Correo "),t.qZA()(),t.TgZ(32,"mat-form-field",1)(33,"mat-label"),t._uU(34,"Rol de Usuario"),t.qZA(),t.TgZ(35,"mat-select",6),t.YNc(36,M,2,2,"mat-option",7),t.qZA(),t.TgZ(37,"mat-error"),t._uU(38," Revise el Rol de Usuario "),t.qZA()()(),t.TgZ(39,"mat-card-actions")(40,"button",8),t._uU(41,"Cancelar"),t.qZA(),t.TgZ(42,"button",9),t._uU(43,"Guardar"),t.qZA()()()()),2&o&&(t.xp6(1),t.Q6J("formGroup",a.formUsuario),t.xp6(35),t.Q6J("ngForOf",a.roles))},dependencies:[p.sg,e._Y,e.Fj,e.JJ,e.JL,e.sg,e.u,g.lW,l.a8,l.dk,l.dn,l.n5,l.$j,l.hq,h.ZT,c.TO,c.KE,c.hX,A.Nt,x.gD,k.ey],styles:["mat-form-field[_ngcontent-%COMP%]{display:block;margin-top:10px}"]}),r})();var L=n(4545),Y=n(7261),m=n(4999);function J(r,i){1&r&&(t.TgZ(0,"th",13),t._uU(1," NOMBRE "),t.qZA())}function O(r,i){if(1&r&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&r){const o=i.$implicit;t.xp6(1),t.lnq("",o.nombre," ",o.paterno," ",o.materno,"")}}function P(r,i){1&r&&(t.TgZ(0,"th",13),t._uU(1," CORREO "),t.qZA())}function F(r,i){if(1&r&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&r){const o=i.$implicit;t.xp6(1),t.hij(" ",o.correo," ")}}function B(r,i){1&r&&(t.TgZ(0,"th",13),t._uU(1," ROL DE USUARIO "),t.qZA())}function E(r,i){if(1&r&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&r){const o=i.$implicit;t.xp6(1),t.hij(" ",o.rol.nombre," ")}}function Q(r,i){1&r&&(t.TgZ(0,"th",13),t._uU(1," OPCIONES "),t.qZA())}function D(r,i){if(1&r){const o=t.EpF();t.TgZ(0,"td",14)(1,"button",15),t.NdJ("click",function(){const u=t.CHM(o).$implicit,d=t.oxw(2);return t.KtG(d.editar(u.uid))}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",15),t.NdJ("click",function(){const u=t.CHM(o).$implicit,d=t.oxw(2);return t.KtG(d.eliminar(u.uid))}),t.TgZ(5,"mat-icon"),t._uU(6,"delete"),t.qZA()()()}}function $(r,i){1&r&&t._UZ(0,"tr",16)}function j(r,i){1&r&&t._UZ(0,"tr",17)}function z(r,i){if(1&r&&(t.TgZ(0,"table",4),t.ynx(1,5),t.YNc(2,J,2,0,"th",6),t.YNc(3,O,2,3,"td",7),t.BQk(),t.ynx(4,8),t.YNc(5,P,2,0,"th",6),t.YNc(6,F,2,1,"td",7),t.BQk(),t.ynx(7,9),t.YNc(8,B,2,0,"th",6),t.YNc(9,E,2,1,"td",7),t.BQk(),t.ynx(10,10),t.YNc(11,Q,2,0,"th",6),t.YNc(12,D,7,0,"td",7),t.BQk(),t.YNc(13,$,1,0,"tr",11),t.YNc(14,j,1,0,"tr",12),t.qZA()),2&r){const o=t.oxw();t.Q6J("dataSource",o.usuariosList),t.xp6(13),t.Q6J("matHeaderRowDef",o.displayHeader),t.xp6(1),t.Q6J("matRowDefColumns",o.displayHeader)}}const H=[{path:"",children:[{path:"",component:(()=>{class r{constructor(o,a,s,u){this.usuarioService=o,this.parametrosService=a,this._snackBar=s,this.dialog=u,this.displayHeader=["nombre","correo","rol","opcion"]}ngOnInit(){this.getUsuarios(),this.getRoles()}getRoles(){this.parametrosService.getRoles().subscribe(o=>{this.rolesList=!0===o.ok?o.data:[]})}getUsuarios(){this.usuarioService.getUsuarios().subscribe(o=>{this.usuariosList=!0===o.ok?o.data:[]})}abrirModal(){this.dialog.open(I,{width:"500px",disableClose:!0,data:{roles:this.rolesList}}).afterClosed().subscribe(o=>{!0===o?(this.getUsuarios(),this.abrirSnackBar("Registro Exitoso")):this.abrirSnackBar("Error al Registrar")})}editar(o){this.usuarioService.getUsuarios(o).subscribe(a=>{!0===a.ok&&this.dialog.open(I,{width:"500px",disableClose:!0,data:{roles:this.rolesList,usuario:a.data}}).afterClosed().subscribe(s=>{!0===s?(this.getUsuarios(),this.abrirSnackBar("Modificaci\xf3n Exitosa")):this.abrirSnackBar("Error al Modificar")})})}eliminar(o){this.dialog.open(L.m,{width:"250px",disableClose:!0,data:{titulo:"Borrar Usuario"}}).afterClosed().subscribe(s=>{!0===s&&this.usuarioService.deleteUsuario(o).subscribe(u=>{!0===u.ok&&(this.getUsuarios(),this.abrirSnackBar("Eliminaci\xf3n Exitosa"))})})}abrirSnackBar(o){this._snackBar.open(o.toString(),"Aceptar",{horizontalPosition:"end",verticalPosition:"top",duration:1500})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(U),t.Y36(C.u),t.Y36(Y.ux),t.Y36(h.uw))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-usuarios"]],decls:11,vars:1,consts:[[1,"row"],[1,"titulo"],["mat-raised-button","","color","primary",1,"titulo",3,"click"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","correo"],["matColumnDef","rol"],["matColumnDef","opcion"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"h1")(2,"mat-icon",1),t._uU(3,"persons"),t.qZA(),t.TgZ(4,"span"),t._uU(5," Usuarios "),t.qZA(),t.TgZ(6,"button",2),t.NdJ("click",function(){return a.abrirModal()}),t.TgZ(7,"mat-icon"),t._uU(8,"person_add"),t.qZA(),t._uU(9," Agregar Usuario "),t.qZA()()(),t.YNc(10,z,15,3,"table",3)),2&o&&(t.xp6(10),t.Q6J("ngIf",a.usuariosList))},dependencies:[p.O5,g.lW,T.Hw,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk],styles:["table[_ngcontent-%COMP%]{width:100%}"]}),r})()},{path:"mi-perfil",component:w},{path:"**",redirectTo:""}]}];let V=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[v.Bz.forChild(H),v.Bz]}),r})();var G=n(898);let W=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[p.ez,V,e.UX,G.q]}),r})()}}]);